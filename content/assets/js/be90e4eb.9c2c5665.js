"use strict";(self.webpackChunkrocketmq_docs=self.webpackChunkrocketmq_docs||[]).push([[8064],{3905:(e,s,t)=>{t.d(s,{Zo:()=>l,kt:()=>g});var n=t(67294);function a(e,s,t){return s in e?Object.defineProperty(e,s,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[s]=t,e}function o(e,s){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);s&&(n=n.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),t.push.apply(t,n)}return t}function r(e){for(var s=1;s<arguments.length;s++){var t=null!=arguments[s]?arguments[s]:{};s%2?o(Object(t),!0).forEach((function(s){a(e,s,t[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(t,s))}))}return e}function i(e,s){if(null==e)return{};var t,n,a=function(e,s){if(null==e)return{};var t,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],s.indexOf(t)>=0||(a[t]=e[t]);return a}(e,s);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],s.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var c=n.createContext({}),m=function(e){var s=n.useContext(c),t=s;return e&&(t="function"==typeof e?e(s):r(r({},s),e)),t},l=function(e){var s=m(e.components);return n.createElement(c.Provider,{value:s},e.children)},u="mdxType",p={inlineCode:"code",wrapper:function(e){var s=e.children;return n.createElement(n.Fragment,{},s)}},d=n.forwardRef((function(e,s){var t=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),u=m(t),d=a,g=u["".concat(c,".").concat(d)]||u[d]||p[d]||o;return t?n.createElement(g,r(r({ref:s},l),{},{components:t})):n.createElement(g,r({ref:s},l))}));function g(e,s){var t=arguments,a=s&&s.mdxType;if("string"==typeof e||a){var o=t.length,r=new Array(o);r[0]=d;var i={};for(var c in s)hasOwnProperty.call(s,c)&&(i[c]=s[c]);i.originalType=e,i[u]="string"==typeof e?e:a,r[1]=i;for(var m=2;m<o;m++)r[m]=t[m];return n.createElement.apply(null,r)}return n.createElement.apply(null,t)}d.displayName="MDXCreateElement"},5902:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>c,contentTitle:()=>r,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>m});var n=t(87462),a=(t(67294),t(3905));const o={},r="Normal Message",i={unversionedId:"featureBehavior/01normalmessage",id:"version-5.0/featureBehavior/01normalmessage",title:"Normal Message",description:"Normal messages are messages that have no special features in Apache RocketMQ. They are different from featured messages such as fifo messages, delay messages, and transaction messages. This topic describes the scenarios, working mechanism, usage, and usage notes of normal messages.",source:"@site/i18n/en/docusaurus-plugin-content-docs/version-5.0/04-featureBehavior/01normalmessage.md",sourceDirName:"04-featureBehavior",slug:"/featureBehavior/01normalmessage",permalink:"/docs/featureBehavior/01normalmessage",draft:!1,editUrl:"https://github.com/apache/rocketmq-site/tree/new-official-website/versioned_docs/version-5.0/04-featureBehavior/01normalmessage.md",tags:[],version:"5.0",frontMatter:{},sidebar:"version-5.0/myAutogeneratedSidebar",previous:{title:"Subscription",permalink:"/docs/domainModel/09subscription"},next:{title:"Delay Message",permalink:"/docs/featureBehavior/02delaymessage"}},c={},m=[{value:"Scenarios",id:"scenarios",level:2},{value:"Working mechanism",id:"working-mechanism",level:2},{value:"Usage limits",id:"usage-limits",level:2},{value:"Example",id:"example",level:2},{value:"Usage notes",id:"usage-notes",level:2}],l={toc:m},u="wrapper";function p(e){let{components:s,...o}=e;return(0,a.kt)(u,(0,n.Z)({},l,o,{components:s,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"normal-message"},"Normal Message"),(0,a.kt)("p",null,"Normal messages are messages that have no special features in Apache RocketMQ. They are different from featured messages such as fifo messages, delay messages, and transaction messages. This topic describes the scenarios, working mechanism, usage, and usage notes of normal messages."),(0,a.kt)("h2",{id:"scenarios"},"Scenarios"),(0,a.kt)("p",null,"Normal messages are generally used in microservice decoupling, data integration, and event-driven scenarios. Most of these scenarios have low or no requirements on timing or the sequence for processing messages other than reliable transmission channels."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Scenario 1: Asynchronous decoupling of microservices"),"\n",(0,a.kt)("img",{alt:"\u5728\u7ebf\u6d88\u606f\u5904\u7406",src:t(34186).Z,width:"1649",height:"675"})),(0,a.kt)("p",null,"The preceding figure shows an online e-commerce transaction scenario. In this scenario, the upstream order system encapsulates order placement and payment as an independent normal message and sends the message to the Apache RocketMQ broker. Downstream systems then subscribe to the message from the broker on demand and process tasks based on the local consumption logic. Messages are independent of each other and do not need to be associated."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Scenario 2: Data integration transmission"),"\n",(0,a.kt)("img",{alt:"\u6570\u636e\u4f20\u8f93",src:t(74694).Z,width:"1647",height:"675"})),(0,a.kt)("p",null,"The preceding figure uses offline log collection as an example. An instrumentation component is used to collect operations logs from frontend applications and forward the logs to Apache RocketMQ. Each message is a piece of log data that requires no processing from Apache RocketMQ. Apache RocketMQ needs only to send the log data to the downstream storage and analysis systems. The backend applications are responsible for subsequent processing tasks."),(0,a.kt)("h2",{id:"working-mechanism"},"Working mechanism"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Definition of normal messages")),(0,a.kt)("p",null,"Normal messages are messages with basic functions in Apache RocketMQ. Normal messages support asynchronous decoupling and communication between producers and consumers.\n",(0,a.kt)("img",{alt:"\u751f\u547d\u5468\u671f",src:t(43493).Z,width:"870",height:"106"})),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Lifecycle of a normal message")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Initialized: The message is built and initialized by the producer and is ready to be sent to a broker.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Ready: The message is sent to the broker, and is visible to the consumer and available for consumption.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Inflight: The message is obtained by the consumer and processed based on the local business logic of the consumer."),(0,a.kt)("p",{parentName:"li"},"In this process, the broker waits for the consumer to complete the consumption and submit the consumption result. If no response is received from the consumer in a certain period of time, Apache RocketMQ retries the message. For more information, see ",(0,a.kt)("a",{parentName:"p",href:"/docs/featureBehavior/10consumerretrypolicy"},"Consumption retry"),".")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Acked: The consumer completes consumption and submits the consumption result to the broker. The broker marks whether the current message is successfully consumed."),(0,a.kt)("p",{parentName:"li"},"By default, Apache RocketMQ retains all messages. When the consumption result is submitted, the message data is logically marked as consumed instead of being deleted immediately. Therefore, the consumer can backtrack the message for re-consumption before it is deleted due to the expiration of the retention period or insufficient storage space.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Deleted: When the retention period of the message expires or the storage space is insufficient, Apache RocketMQ deletes the earliest saved message from the physical file in a rolling manner. For more information, see ",(0,a.kt)("a",{parentName:"p",href:"/docs/featureBehavior/11messagestorepolicy"},"Message storage and cleanup"),"."))),(0,a.kt)("h2",{id:"usage-limits"},"Usage limits"),(0,a.kt)("p",null,"Normal messages support only topics whose MessageType is Normal."),(0,a.kt)("h2",{id:"example"},"Example"),(0,a.kt)("p",null,"You can set index keys and filter tags to filter or search for normal messages. The following sample code shows how to send and receive normal messages in Java:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'// Send a normal message. \n  MessageBuilder messageBuilder = new MessageBuilder();\n  Message message = messageBuilder.setTopic("topic")\n  // Specify the message index key so that you can accurately search for the message by using a keyword.\n  .setKeys("messageKey")\n  // Specify the message tag so that the consumer can filter the message based on the specified tag.\n  .setTag("messageTag")\n  // Message body. \n  .setBody("messageBody".getBytes())\n  .build();\n  try {\n    // Send the message. You need to pay attention to the sending result and capture exceptions such as failures. \n    SendReceipt sendReceipt = producer.send(message);\n    System.out.println(sendReceipt.getMessageId());\n  } catch (ClientException e) {\n      e.printStackTrace();\n  }\n  // Consumption example 1: When you consume a normal message as a push consumer, you need only to process the message in the message listener. \n  MessageListener messageListener = new MessageListener() {\n      @Override\n      public ConsumeResult consume(MessageView messageView) {\n          System.out.println(messageView);\n          // Return the status based on the consumption result. \n          return ConsumeResult.SUCCESS;\n      }\n  };\n  // Consumption example 2: When you consume a normal message as a simple consumer, you must obtain and consume the message, and submit the consumption result. \n  List<MessageView> messageViewList = null;\n  try {\n      messageViewList = simpleConsumer.receive(10, Duration.ofSeconds(30));\n      messageViewList.forEach(messageView -> {\n          System.out.println(messageView);\n          // After consumption is complete, you must invoke ACK to submit the consumption result. \n          try {\n              simpleConsumer.ack(messageView);\n          } catch (ClientException e) {\n              e.printStackTrace();\n          }\n      });\n      } catch (ClientException e) {\n      // If the pull fails due to system traffic throttling or other reasons, you must re-initiate the request to obtain the message. \n      e.printStackTrace();\n  }\n')),(0,a.kt)("h2",{id:"usage-notes"},"Usage notes"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Set a globally unique index key to facilitate troubleshooting")),(0,a.kt)("p",null,"You can set custom index keys, which are message keys, in Apache RocketMQ. When you query and trace messages, the index key can help you find these messages efficiently and accurately."),(0,a.kt)("p",null,"Therefore, when you send messages, we recommend that you use the unique information of the service, such as order ID and user ID, as an index. This helps you find messages quickly in the future."))}p.isMDXComponent=!0},43493:(e,s,t)=>{t.d(s,{Z:()=>n});const n=t.p+"assets/images/lifecyclefornormal-e8a2a7e42a0722f681eb129b51e1bd66.png"},74694:(e,s,t)=>{t.d(s,{Z:()=>n});const n=t.p+"assets/images/offlineprocess-027f6f1642db3d78ff29890abbe38bf8.png"},34186:(e,s,t)=>{t.d(s,{Z:()=>n});const n=t.p+"assets/images/onlineprocess-cfd38e3de3a5fc1ee76f17331cc5b828.png"}}]);