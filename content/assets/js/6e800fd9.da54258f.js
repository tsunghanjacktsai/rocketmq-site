"use strict";(self.webpackChunkrocketmq_docs=self.webpackChunkrocketmq_docs||[]).push([[5591],{15680:(e,n,t)=>{t.d(n,{xA:()=>p,yg:()=>g});var o=t(96540);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function c(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?c(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},c=Object.keys(e);for(o=0;o<c.length;o++)t=c[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(o=0;o<c.length;o++)t=c[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=o.createContext({}),i=function(e){var n=o.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},p=function(e){var n=i(e.components);return o.createElement(l.Provider,{value:n},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},d=o.forwardRef((function(e,n){var t=e.components,r=e.mdxType,c=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=i(t),d=r,g=u["".concat(l,".").concat(d)]||u[d]||m[d]||c;return t?o.createElement(g,a(a({ref:n},p),{},{components:t})):o.createElement(g,a({ref:n},p))}));function g(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var c=t.length,a=new Array(c);a[0]=d;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[u]="string"==typeof e?e:r,a[1]=s;for(var i=2;i<c;i++)a[i]=t[i];return o.createElement.apply(null,a)}return o.createElement.apply(null,t)}d.displayName="MDXCreateElement"},30124:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>m,frontMatter:()=>c,metadata:()=>s,toc:()=>i});var o=t(58168),r=(t(96540),t(15680));const c={},a="RocketMQ Connect in Action 4",s={unversionedId:"connect/07RocketMQ Connect In Action4",id:"version-5.0/connect/07RocketMQ Connect In Action4",title:"RocketMQ Connect in Action 4",description:"SFTP Server (File Data) -> RocketMQ Connect -> SFTP Server (File)",source:"@site/i18n/en/docusaurus-plugin-content-docs/version-5.0/10-connect/07RocketMQ Connect In Action4.md",sourceDirName:"10-connect",slug:"/connect/07RocketMQ Connect In Action4",permalink:"/docs/connect/07RocketMQ Connect In Action4",draft:!1,editUrl:"https://github.com/apache/rocketmq-site/tree/new-official-website/versioned_docs/version-5.0/10-connect/07RocketMQ Connect In Action4.md",tags:[],version:"5.0",frontMatter:{},sidebar:"version-5.0/myAutogeneratedSidebar",previous:{title:"RocketMQ Connect in Action 3",permalink:"/docs/connect/06RocketMQ Connect In Action3"},next:{title:"RocketMQ Connect in Action 5",permalink:"/docs/connect/08RocketMQ  Connect In Action5-ES"}},l={},i=[{value:"Preparation",id:"preparation",level:2},{value:"Start RocketMQ",id:"start-rocketmq",level:3},{value:"Build Connector Runtime",id:"build-connector-runtime",level:3},{value:"Build SFTP Connector Plugin",id:"build-sftp-connector-plugin",level:3},{value:"Run Connector Worker in Standalone Mode",id:"run-connector-worker-in-standalone-mode",level:3},{value:"Set up an SFTP server",id:"set-up-an-sftp-server",level:3},{value:"Create Source Test File",id:"create-source-test-file",level:3},{value:"Start Connector",id:"start-connector",level:2},{value:"Start SFTP Source Connector",id:"start-sftp-source-connector",level:3},{value:"Start SFTP Sink Connector",id:"start-sftp-sink-connector",level:3}],p={toc:i},u="wrapper";function m(e){let{components:n,...t}=e;return(0,r.yg)(u,(0,o.A)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,r.yg)("h1",{id:"rocketmq-connect-in-action-4"},"RocketMQ Connect in Action 4"),(0,r.yg)("p",null,"SFTP Server (File Data) -> RocketMQ Connect -> SFTP Server (File)"),(0,r.yg)("h2",{id:"preparation"},"Preparation"),(0,r.yg)("h3",{id:"start-rocketmq"},"Start RocketMQ"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},"Linux/Unix/Mac"),(0,r.yg)("li",{parentName:"ol"},"64bit JDK 1.8+;"),(0,r.yg)("li",{parentName:"ol"},"Maven 3.2.x+;"),(0,r.yg)("li",{parentName:"ol"},"Start RocketMQ. Either ",(0,r.yg)("a",{parentName:"li",href:"https://rocketmq.apache.org/docs/4.x/"},"RocketMQ 4.x")," or\n",(0,r.yg)("a",{parentName:"li",href:"https://rocketmq.apache.org/docs/quickStart/01quickstart/"},"RocketMQ 5.x")," 5.x version can be used;"),(0,r.yg)("li",{parentName:"ol"},"Test RocketMQ message sending and receiving using the tool.")),(0,r.yg)("p",null,"Here, use the environment variable NAMESRV_ADDR to inform the tool client of the NameServer address of RocketMQ as localhost:9876."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"#$ cd distribution/target/rocketmq-4.9.7/rocketmq-4.9.7\n$ cd distribution/target/rocketmq-5.1.4/rocketmq-5.1.4\n\n$ export NAMESRV_ADDR=localhost:9876\n$ sh bin/tools.sh org.apache.rocketmq.example.quickstart.Producer\n SendResult [sendStatus=SEND_OK, msgId= ...\n\n$ sh bin/tools.sh org.apache.rocketmq.example.quickstart.Consumer\n ConsumeMessageThread_%d Receive New Messages: [MessageExt...\n")),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Note"),": RocketMQ has the feature of automatically creating Topic and Group. When sending or subscribing to messages,\nif the corresponding Topic or Group does not exist, RocketMQ will automatically create them. Therefore,\nthere is no need to create Topic and Group in advance."),(0,r.yg)("h3",{id:"build-connector-runtime"},"Build Connector Runtime"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"git clone https://github.com/apache/rocketmq-connect.git\n\ncd  rocketmq-connect\n\nexport RMQ_CONNECT_HOME=`pwd`\n\nmvn -Prelease-connect -Dmaven.test.skip=true clean install -U\n")),(0,r.yg)("h3",{id:"build-sftp-connector-plugin"},"Build SFTP Connector Plugin"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"cd $RMQ_CONNECT_HOME/connectors/rocketmq-connect-sftp/\n\nmvn clean package -Dmaven.test.skip=true\n")),(0,r.yg)("p",null,"Put the compiled jar of the SFTP RocketMQ Connector into the Plugin directory for runtime loading."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"mkdir -p /Users/YourUsername/rocketmqconnect/connector-plugins\ncp target/rocketmq-connect-sftp-0.0.1-SNAPSHOT-jar-with-dependencies.jar /Users/YourUsername/rocketmqconnect/connector-plugins\n")),(0,r.yg)("h3",{id:"run-connector-worker-in-standalone-mode"},"Run Connector Worker in Standalone Mode"),(0,r.yg)("p",null,"Modify the ",(0,r.yg)("inlineCode",{parentName:"p"},"connect-standalone.conf")," file to configure the RocketMQ connection\naddress and other information."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"cd $RMQ_CONNECT_HOME/distribution/target/rocketmq-connect-0.0.1-SNAPSHOT/rocketmq-connect-0.0.1-SNAPSHOT\n\nvim conf/connect-standalone.conf\n")),(0,r.yg)("p",null,"Example configuration information is as follows:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},'workerId=standalone-worker\nstorePathRootDir=/Users/YourUsername/rocketmqconnect/storeRoot\n\n## Http port for user to access REST API\nhttpPort=8082\n\n# Rocketmq namesrvAddr\nnamesrvAddr=localhost:9876\n\n# RocketMQ acl\naclEnable=false\n#accessKey=rocketmq\n#secretKey=12345678\n\nclusterName="DefaultCluster"\n\n# Plugin path for loading Source/Sink Connectors\npluginPaths=/Users/YourUsername/rocketmqconnect/connector-plugins\n')),(0,r.yg)("p",null,"In standalone mode, RocketMQ Connect persistently stores the synchronization checkpoint information\nin the local file directory specified by storePathRootDir."),(0,r.yg)("blockquote",null,(0,r.yg)("p",{parentName:"blockquote"},"storePathRootDir=/Users/YourUsername/rocketmqconnect/storeRoot")),(0,r.yg)("p",null,"If you want to reset the synchronization checkpoint, you need to delete the persisted checkpoint information files."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"rm -rf /Users/YourUsername/rocketmqconnect/storeRoot/*\n")),(0,r.yg)("p",null,"To start Connector Worker in standalone mode:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"sh bin/connect-standalone.sh -c conf/connect-standalone.conf &\n")),(0,r.yg)("h3",{id:"set-up-an-sftp-server"},"Set up an SFTP server"),(0,r.yg)("p",null,"SFTP (SSH File Transfer Protocol) is a file transfer protocol used for secure file transfers between computers.\nSFTP is built on top of the SSH (Secure Shell) protocol and utilizes encryption and authentication."),(0,r.yg)("p",null,'We will use the built-in SFTP service in macOS (by enabling "Remote Login" access).\nFor detailed instructions, please refer to the\n',(0,r.yg)("a",{parentName:"p",href:"https://support.apple.com/guide/mac-help/allow-a-remote-computer-to-access-your-mac-mchlp1066/mac"},"Allow a remote computer to access your Mac"),"document."),(0,r.yg)("h3",{id:"create-source-test-file"},"Create Source Test File"),(0,r.yg)("p",null,"Create a test file named ",(0,r.yg)("inlineCode",{parentName:"p"},"source.txt")," and write some test data to it:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"mkdir -p /Users/YourUsername/rocketmqconnect/sftp-test/\n\ncd /Users/YourUsername/rocketmqconnect/sftp-test/\n\ntouch source.txt\n\necho 'John Doe|100000202211290001|20221129001|30000.00|2022-11-28|03:00:00|7.00\nJane Smith|100000202211290002|20221129002|40000.00|2022-11-28|04:00:00|9.00\nBob Johnson|100000202211290003|20221129003|50000.00|2022-11-28|05:00:00|12.00' >> source.txt\n")),(0,r.yg)("p",null,"Log in to the SFTP service to verify that you can access it normally. Enter the following command, then enter your\npassword :"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"# sftp -P port YourUsername@hostname\nsftp -P 22 YourUsername@127.0.0.1\n")),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Note"),": Since this is the SFTP service provided by your local MAC OS, the address is ",(0,r.yg)("inlineCode",{parentName:"p"},"127.0.0.1")," and the port is the default 22."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"sftp> cd /Users/YourUsername/rocketmqconnect/sftp-test/\nsftp> ls source.txt\nsftp> bye\n")),(0,r.yg)("h2",{id:"start-connector"},"Start Connector"),(0,r.yg)("h3",{id:"start-sftp-source-connector"},"Start SFTP Source Connector"),(0,r.yg)("p",null,"Run the following command to start the SFTP source connector. This connector will connect to the\nSFTP service to read from the ",(0,r.yg)("inlineCode",{parentName:"p"},"source.txt")," file. For each line of text in the file, the connector\nwill parse and package the contents into a generic ConnectRecord object, which will then be sent\nto a RocketMQ topic for consumption by sink connectors."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},'curl -X POST --location "http://localhost:8082/connectors/SftpSourceConnector" --http1.1 \\\n    -H "Host: localhost:8082" \\\n    -H "Content-Type: application/json" \\\n    -d \'{\n          "connector.class": "org.apache.rocketmq.connect.http.sink.SftpSourceConnector",\n          "host": "127.0.0.1",\n          "port": 22,\n          "username": "YourUsername",\n          "password": "yourPassword",\n          "filePath": "/Users/YourUsername/rocketmqconnect/sftp-test/source.txt",\n          "connect.topicname": "sftpTopic",\n          "fieldSeparator": "|",\n          "fieldSchema": "username|idCardNo|orderNo|orderAmount|trxDate|trxTime|profit"\n        }\'\n')),(0,r.yg)("p",null,"If the curl request returns status: 200, it indicates that the connector was successfully\ncreated. An example response would look like this:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{"status":200,"body":{"connector.class":"...\n')),(0,r.yg)("p",null,"To confirm that the file source connector has started successfully, run the following command:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"tail -100f ~/logs/rocketmqconnect/connect_runtime.log\n")),(0,r.yg)("blockquote",null,(0,r.yg)("p",{parentName:"blockquote"},"Start connector SftpSourceConnector and set target state STARTED successed!!")),(0,r.yg)("h3",{id:"start-sftp-sink-connector"},"Start SFTP Sink Connector"),(0,r.yg)("p",null,"Run the following command to start the SFTP sink connector. This connector will subscribe to the RocketMQ topic\nto consume messages and convert each one into a single line of text, which will then be written to the destination\nfile ",(0,r.yg)("inlineCode",{parentName:"p"},"sink.txt")," using the SFTP protocol:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},'curl -X POST --location "http://localhost:8082/connectors/SftpSinkConnector" --http1.1 \\\n    -H "Host: localhost:8082" \\\n    -H "Content-Type: application/json" \\\n    -d \'{\n          "connector.class": "org.apache.rocketmq.connect.http.sink.SftpSinkConnector",\n          "host": "127.0.0.1",\n          "port": 22,\n          "username": "YourUsername",\n          "password": "yourPassword",\n          "filePath": "/Users/YourUsername/rocketmqconnect/sftp-test/sink.txt",\n          "connect.topicnames": "sftpTopic",\n          "fieldSeparator": "|",\n          "fieldSchema": "username|idCardNo|orderNo|orderAmount|trxDate|trxTime|profit"\n        }\'\n')),(0,r.yg)("p",null,"If the curl request returns status: 200, it indicates that the connector was successfully\ncreated. An example response would look like this:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{"status":200,"body":{"connector.class":"...\n')),(0,r.yg)("p",null,"Check the logs to confirm successful startup of the SFTP sink connector:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"tail -100f ~/logs/rocketmqconnect/connect_runtime.log\n")),(0,r.yg)("blockquote",null,(0,r.yg)("p",{parentName:"blockquote"},"Start connector SftpSinkConnector and set target state STARTED successed!!")),(0,r.yg)("p",null,"Confirm that the data has been written to the destination file by running the following command:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"cat /Users/YourUsername/rocketmqconnect/sftp-test/sink.txt\n")),(0,r.yg)("p",null,"If the ",(0,r.yg)("inlineCode",{parentName:"p"},"sink.txt")," file has been generated and its contents match those of the ",(0,r.yg)("inlineCode",{parentName:"p"},"source.txt")," file, the entire process is working correctly."),(0,r.yg)("p",null,"Write more test data to the ",(0,r.yg)("inlineCode",{parentName:"p"},"source.txt")," file to continue testing:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"cd /Users/YourUsername/rocketmqconnect/sftp-test/\n\necho 'John Doe|100000202211290001|20221129001|30000.00|2022-11-28|03:00:00|7.00\nJane Smith|100000202211290002|20221129002|40000.00|2022-11-28|04:00:00|9.00\nBob Johnson|100000202211290003|20221129003|50000.00|2022-11-28|05:00:00|12.00' >> source.txt\n\n# Wait a few seconds to give the connector time to replicate data to the sink file.\nsleep 10\n\ncat /Users/YourUsername/rocketmqconnect/sftp-test/sink.txt\n")),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Note"),": The order of file contents may vary because the ",(0,r.yg)("inlineCode",{parentName:"p"},"rocketmq-connect-sftp")," uses ",(0,r.yg)("inlineCode",{parentName:"p"},"normal message")," when\nsending and receiving messages to/from a RocketMQ topic. This is different from ",(0,r.yg)("inlineCode",{parentName:"p"},"ordered message"),", and consuming\n",(0,r.yg)("inlineCode",{parentName:"p"},"normal messages")," does not guarantee the order."))}m.isMDXComponent=!0}}]);